import{K as e,e as t,z as l,A as a,c as n,o,w as s,h as i,k as r,B as u,p as d,a as c,t as f,F as p,D as v}from"./index-CA6UagU_.js";import{_ as b,a as m}from"./sk-roller.vue_vue_type_script_setup_true_lang.CuUGw2Ph.js";function h(e){return null==e}const g={label:"label",value:"value",disabled:"disabled"};function y(e,t){if("object"==typeof(l=e)&&null!==l&&"string"==typeof l.label&&void 0!==l.value)return e;var l;if("string"==typeof e||"number"==typeof e)return{label:String(e),value:e,disabled:!1};if("object"==typeof e&&null!==e){const l={label:e[t.label]??String(e[t.value]??""),value:e[t.value],disabled:Boolean(e[t.disabled])},a=new Set([t.label,t.value,t.disabled]);for(const t in e)a.has(t)||(l[t]=e[t]);return l}return{label:String(e),value:e,disabled:!1}}function A(e,t){if(!e||Array.isArray(e)&&0===e.length)return[];if(t&&"function"==typeof t)try{const l=t(e);return Array.isArray(l[0])?l:[l]}catch(a){return console.error("[SkPicker] 自定义转换函数执行失败:",a),[]}const l=g;return Array.isArray(e)?e.length>0&&Array.isArray(e[0])?e.map(e=>e.map(e=>y(e,l))):[e.map(e=>y(e,l))]:(console.warn("[SkPicker] 需要数组格式的数据"),[])}function k(){return e({value:"",options:[]})}const _=t({inheritAttrs:!1,options:{virtualHost:!0},__name:"sk-picker",props:l({columns:{},itemHeight:{default:44},visibleItemCount:{default:5},disabled:{type:Boolean,default:!1},transform:{},clax:{}},{modelValue:{default:()=>[]},modelModifiers:{}}),emits:l(["change"],["update:modelValue"]),setup(t){const l=t,g=a(t,"modelValue"),y=function({columns:t,initial:l,transform:a,onChange:n}){let o=A(t,a);const s=e(Array.from({length:o.length}).map(()=>k())),i=()=>1===o.length&&o[0].some(e=>e.sub&&e.sub.length>0),r=e=>{if(!i())return;const t=s[e];if(!t)return;const l=t.options.find(e=>e.value===t.value);for(;s.length>e+1;)s.pop();if(l&&l.sub&&l.sub.length>0){const t=k();t.options=l.sub;const a=t.options.find(e=>!e.disabled);a&&(t.value=a.value),s.push(t),r(e+1)}},u=(e,t)=>{if(e<0||e>=s.length)return void console.warn(`[usePicker] 无效的列索引: ${e}`);const l=s[e],a=l.options.find(e=>e.value===t);a?a.disabled?console.warn(`[usePicker] 选项 ${t} 已被禁用`):(l.value=t,i()&&r(e),null==n||n({columnIndex:e,value:t,option:a})):console.warn(`[usePicker] 在第 ${e} 列中找不到值为 ${t} 的选项`)},d=()=>s.map(e=>e.value),c=()=>s.map(e=>e.options.find(t=>t.value===e.value)||e.options.find(e=>!e.disabled)).filter(Boolean),f=()=>s.every(e=>{const t=e.options.find(t=>t.value===e.value);return t&&!t.disabled});i()?s[0].options=o[0]:o.forEach((e,t)=>{s[t]&&(s[t].options=e)}),(()=>{if(i()){if(void 0!==l){const e=Array.isArray(l)?l:[l];let t=0;for(const l of e)if(t<s.length){const e=s[t].options.find(e=>e.value===l);if(!e||e.disabled)break;s[t].value=l,r(t),t++}}if(s[0]&&(""===s[0].value||void 0===s[0].value)){const e=s[0].options.find(e=>!e.disabled);e&&(s[0].value=e.value,r(0))}}else void 0!==l&&(Array.isArray(l)?l:[l]).forEach((e,t)=>{if(t<s.length&&s[t]){const l=s[t].options.find(t=>t.value===e);l&&!l.disabled&&(s[t].value=e)}}),s.forEach(e=>{if(""===e.value||void 0===e.value){const t=e.options.find(e=>!e.disabled);t&&(e.value=t.value)}})})();const p=()=>{if(!i())return c();const e=[];for(let t=0;t<s.length;t++){const l=s[t],a=l.options.find(e=>e.value===l.value);a&&e.push(a)}return e};return{columns:s,select:u,getSelectedValues:d,getSelectedOptions:c,getColumnOptions:e=>e<0||e>=s.length?[]:s[e].options,validate:f,reset:()=>{if(i()){if(s[0]){const e=s[0].options.find(e=>!e.disabled);s[0].value=e?e.value:"",r(0)}}else s.forEach(e=>{const t=e.options.find(e=>!e.disabled);e.value=t?t.value:""})},setColumns:e=>{const t=A(e,a);if(o=t,i()){for(;s.length>1;)s.pop();if(s[0]||s.push(k()),s[0].options=t[0],!s[0].options.find(e=>e.value===s[0].value&&!e.disabled)){const e=s[0].options.find(e=>!e.disabled);s[0].value=e?e.value:""}r(0)}else{for(;s.length>t.length;)s.pop();for(;s.length<t.length;)s.push(k());t.forEach((e,t)=>{s[t].options=e;const l=s[t].value;if(!e.find(e=>e.value===l&&!e.disabled)){const l=e.find(e=>!e.disabled);s[t].value=l?l.value:""}})}},setValues:e=>{Array.isArray(e)?e.forEach((e,t)=>{t<s.length&&u(t,e)}):console.warn("[usePicker] setValues 需要数组参数")},isCascadeMode:i,getCascadePath:p,get selectedValues(){return d()},get selectedOptions(){return c()},get isValid(){return f()},get cascadePath(){return p()}}}({columns:l.columns,initial:g.value,transform:l.transform}),{columns:_,select:V}=y;return(e,t)=>(o(),n(b,{"item-height":e.itemHeight,"visible-item-count":e.visibleItemCount,clax:e.clax},{default:s(()=>[(o(!0),i(p,null,r(u(_),({value:t,options:a},i)=>(o(),n(m,{key:i,options:a,"model-value":t,disabled:e.disabled,"onUpdate:modelValue":e=>!u(h)(e)&&((e,t)=>{l.disabled||(V(e,t),v(()=>g.value=y.selectedValues))})(i,e)},{option:s(({option:t,selected:l})=>[d(e.$slots,"option",{option:t,selected:l,columnIndex:i},()=>[c("span",{class:"text-center truncate"},f(t.label),1)])]),_:2},1032,["options","model-value","disabled","onUpdate:modelValue"]))),128))]),_:3},8,["item-height","visible-item-count","clax"]))}});export{_};
